<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Detail Skrining</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #f9f9f9;
        font-size: 14px;
      }
      .header-bar {
        background-color: #d5f7fa;
        padding: 10px 15px;
        font-size: 20px;
        font-weight: bold;
        color: blue;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .status-badge span {
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 14px;
        font-weight: bold;
        color: white;
      }
      .belum {
        background-color: red;
      }
      .mulai {
        background-color: green;
      }
      .section-title {
        background-color: orange;
        color: white;
        padding: 5px 10px;
        font-weight: bold;
        display: inline-block;
        margin-bottom: 10px;
      }
      .detail-row span:first-child {
        font-weight: bold;
        width: 180px;
        display: inline-block;
        color: #333;
      }
      .table-section th {
        background-color: #ccc;
        font-weight: bold;
      }
      .sub-header {
        background-color: #f1f1f1;
        font-weight: bold;
      }
      .highlight-yellow {
        background-color: #fff8dc;
      }
      .input-sm {
        width: 100px;
      }
      .detail-row {
        display: flex;
        margin-bottom: 4px;
      }

      .detail-row span:first-child {
        display: inline-block;
        width: 180px; /* sesuaikan */
        font-weight: bold;
      }

      .detail-row span:first-child::after {
        content: " :";
        margin-left: 4px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- HEADER -->
      <div class="header-bar">
        <span>Cek Kesehatan Gratis</span>
        <div class="status-badge">
          <span class="belum">Belum Pemeriksaan</span>
          <span class="mulai">Mulai Pemeriksaan</span>
        </div>
      </div>
    </div>
    <div class="container mt-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <!-- Kategori -->
          <div class="section-title">Remaja</div>

          <!-- Detail Data -->
          <div class="d-flex align-items-start mb-3">
            <!-- Kolom Detail -->
            <div class="flex-grow-1">
              <div class="detail-row">
                <span>Nama</span> <span id="nama"></span>
              </div>
              <div class="detail-row">
                <span>NIK</span> <span id="nik"></span>
              </div>
              <div class="detail-row">
                <span>Tanggal Lahir</span> <span id="tanggal_lahir"></span>
              </div>
              <div class="detail-row">
                <span>Umur</span> <span id="umur"></span>
              </div>
              <div class="detail-row">
                <span>Jenis Kelamin</span> <span id="jk"></span>
              </div>
              <div class="detail-row">
                <span>Nama Ibu/Wali</span> <span id="wali"></span>
              </div>
              <div class="detail-row">
                <span>Nomor Tiket</span> <span id="tiket"></span>
              </div>
            </div>

            <!-- Kolom Icon -->
            <div class="ms-3">
              <img
                src="../3b48356f-6b37-4dd0-83ed-4b3c4b1e020b.png"
                alt="Ikon Gender"
                style="width: 150px"
              />
            </div>
          </div>

          <!-- Tabel Layanan -->
          <table class="table table-bordered table-section">
            <thead>
              <tr>
                <th colspan="3">01. Gizi Anak Sekolah</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Berat Badan *</td>
                <td id="berat" class="text-center"></td>
                <td>Kg</td>
              </tr>
              <tr>
                <td>Tinggi Badan *</td>
                <td id="tinggi" class="text-center"></td>
                <td>cm</td>
              </tr>
              <tr class="sub-header">
                <td colspan="3">Hasil IMT/U</td>
              </tr>
              <tr>
                <td>Hasil IMT</td>
                <td colspan="2" id="imt-hasil" class="text-center"></td>
              </tr>
            </tbody>
          </table>

          <!-- <table class="table table-bordered table-section">
            <thead>
              <tr>
                <th colspan="3">02. Tekanan Darah (Anak Sekolah)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Tekanan Darah Sistolik *</td>
                <td>
                  <input type="number" class="form-control input-sm" /> mmHg
                </td>
                <td></td>
              </tr>
              <tr>
                <td>Tekanan Darah Diastolik</td>
                <td>
                  <input type="number" class="form-control input-sm" /> mmHg
                </td>
                <td></td>
              </tr>
            </tbody>
          </table>

          <table class="table table-bordered table-section">
            <thead>
              <tr>
                <th colspan="3">03. Skrining Gula Darah (Anak Sekolah)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Gula Darah Sewaktu (GDS)</td>
                <td>
                  <input type="number" class="form-control input-sm" /> mg/dl
                </td>
                <td></td>
              </tr>
            </tbody>
          </table>

          <table class="table table-bordered table-section">
            <thead>
              <tr>
                <th colspan="3">04. Pemeriksaan Gigi - Anak Sekolah</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Gigi Karies</td>
                <td colspan="2">
                  <label><input type="radio" name="gigi" /> Tidak ada</label>
                  <label><input type="radio" name="gigi" /> 1</label>
                  <label><input type="radio" name="gigi" /> 2</label>
                  <label><input type="radio" name="gigi" /> 3</label>
                </td>
              </tr>
            </tbody>
          </table> -->
        </div>
      </div>
    </div>

    <script>
      const params = new URLSearchParams(window.location.search);
      const no = params.get("no");
      const nama = params.get("nama");

      const apiURL =
        "https://script.google.com/macros/s/AKfycbxvijgSaKZqTv2I84_wGTL3LTM3MqaPUQY8GNoKc3qvE6y94hI07yI37LxpbijoE6KM/exec";

      fetch(apiURL)
        .then((res) => res.json())
        .then((json) => {
          const data = Array.isArray(json) ? json : json.data || [];
          const siswa = data.find(
            (s) =>
              (no && String(s.No).trim() === String(no).trim()) ||
              (nama &&
                String(s.Nama).trim().toLowerCase() ===
                  String(nama).trim().toLowerCase())
          );
          if (!siswa) return;

          // Tampilkan data siswa
          document.getElementById("nama").innerText = siswa.Nama || "";
          document.getElementById("nik").innerText = siswa.NIK || "";
          document.getElementById("tanggal_lahir").innerText =
            siswa["Tanggal Lahir"] || "";
          document.getElementById("umur").innerText = siswa.Umur || "";
          document.getElementById("jk").innerText =
            siswa["Jenis Kelamin"] || "";
          document.getElementById("wali").innerText =
            siswa["Nama Orang Tua/Wali"] || "";
          document.getElementById("tiket").innerText =
            siswa["Nomor Tiket"] || "";
          document.getElementById("tinggi").innerText = siswa["Tinggi"] || "";
          document.getElementById("berat").innerText = siswa["Berat"] || "";

          // Ambil dan isi berat & tinggi badan
          if (siswa.Berat) document.getElementById("berat").value = siswa.Berat;
          if (siswa.Tinggi)
            document.getElementById("tinggi").value = siswa.Tinggi;

          // Hitung IMT (Berat / (Tinggi dalam meter)^2)
          const berat = parseFloat(siswa.Berat);
          const tinggi = parseFloat(siswa.Tinggi) / 100; // cm ke meter
          if (!isNaN(berat) && !isNaN(tinggi) && tinggi > 0) {
            const imt = berat / (tinggi * tinggi);
            let kategori = "";
            if (imt < 18.5) kategori = "Kurus";
            else if (imt >= 18.5 && imt < 25) kategori = "Normal";
            else if (imt >= 25 && imt < 30) kategori = "Berat Badan Lebih";
            else kategori = "Obesitas";

            document.getElementById("imt-hasil").innerText =
              imt.toFixed(2) + " (" + kategori + ")";
          }
        });
    </script>
  </body>
</html>
